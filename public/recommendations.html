<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ä¹¦æ¨è - å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: #f5f7fa; min-height: 100vh; }
        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .navbar-brand { font-size: 24px; font-weight: bold; cursor: pointer; }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .btn-back { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 20px; border-radius: 5px; text-decoration: none; transition: all 0.3s; }
        .btn-back:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .page-header { background: white; border-radius: 10px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .page-header h2 { color: #333; margin-bottom: 10px; }
        .page-header p { color: #666; font-size: 14px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .tab { padding: 12px 25px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-weight: 500; color: #555; }
        .tab:hover { border-color: #667eea; color: #667eea; }
        .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: transparent; }
        .recommend-section { background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: none; }
        .recommend-section.active { display: block; }
        .section-title { color: #333; font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .book-card { background: #f8f9fa; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: #667eea; }
        .book-cover { width: 100%; height: 250px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; margin-bottom: 12px; }
        .book-title { font-weight: 600; color: #333; margin-bottom: 8px; font-size: 15px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .book-author { color: #666; font-size: 13px; margin-bottom: 8px; }
        .book-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .book-category { background: #e3f2fd; color: #1976d2; padding: 4px 10px; border-radius: 12px; font-size: 12px; }
        .book-score { color: #f39c12; font-weight: 600; font-size: 13px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 64px; margin-bottom: 15px; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .reason-tag { display: inline-block; background: #fff3cd; color: #856404; padding: 3px 8px; border-radius: 10px; font-size: 11px; margin-top: 5px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand" onclick="location.href='reader.html'">ğŸ“š å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</div>
        <div class="user-info">
            <span id="userName">åŠ è½½ä¸­...</span>
            <a href="reader.html" class="btn-back">è¿”å›ä¸»é¡µ</a>
        </div>
    </nav>
    <div class="container">
        <div class="page-header">
            <h2>ğŸ“– æ™ºèƒ½å›¾ä¹¦æ¨è</h2>
            <p>åŸºäºå¤šç§ç®—æ³•ä¸ºæ‚¨æ¨èæ„Ÿå…´è¶£çš„å›¾ä¹¦</p>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('personal')">ğŸ“š ä¸ªæ€§åŒ–æ¨è</div>
            <div class="tab" onclick="switchTab('similar')">ğŸ‘¥ ç›¸ä¼¼è¯»è€…æ¨è</div>
            <div class="tab" onclick="switchTab('popular')">ğŸ”¥ çƒ­é—¨å›¾ä¹¦</div>
            <div class="tab" onclick="switchTab('category')">ğŸ¯ ç±»åˆ«å¹³è¡¡æ¨è</div>
            <div class="tab" onclick="switchTab('new')">âœ¨ æ–°ä¹¦æ¨è</div>
            <div class="tab" onclick="switchTab('hybrid')">ğŸŒŸ ç»¼åˆæ¨è</div>
        </div>
        <div id="personal" class="recommend-section active">
            <div class="section-title">åŸºäºæ‚¨çš„å€Ÿé˜…å†å²æ¨è</div>
            <div id="personalBooks" class="book-grid"><div class="loading">åŠ è½½ä¸­...</div></div>
        </div>
        <div id="similar" class="recommend-section">
            <div class="section-title">ä¸æ‚¨å…´è¶£ç›¸ä¼¼çš„è¯»è€…ä¹Ÿå–œæ¬¢</div>
            <div id="similarBooks" class="book-grid"><div class="loading">åŠ è½½ä¸­...</div></div>
        </div>
        <div id="popular" class="recommend-section">
            <div class="section-title">å½“å‰æœ€å—æ¬¢è¿çš„å›¾ä¹¦</div>
            <div id="popularBooks" class="book-grid"><div class="loading">åŠ è½½ä¸­...</div></div>
        </div>
        <div id="category" class="recommend-section">
            <div class="section-title">æ‹“å±•æ‚¨çš„é˜…è¯»é¢†åŸŸ</div>
            <div id="categoryBooks" class="book-grid"><div class="loading">åŠ è½½ä¸­...</div></div>
        </div>
        <div id="new" class="recommend-section">
            <div class="section-title">æœ€æ–°ä¸Šæ¶å›¾ä¹¦</div>
            <div id="newBooks" class="book-grid"><div class="loading">åŠ è½½ä¸­...</div></div>
        </div>
        <div id="hybrid" class="recommend-section">
            <div class="section-title">ç»¼åˆå¤šç§å› ç´ ä¸ºæ‚¨æ¨è</div>
            <div id="hybridBooks" class="book-grid"><div class="loading">åŠ è½½ä¸­...</div></div>
        </div>
    </div>
    <script>
        const API_BASE_URL = 'http://localhost:8080';
        let currentUser = null;
        let currentTab = 'personal';
        let loadedTabs = new Set();

        window.onload = function() {
            currentUser = JSON.parse(localStorage.getItem('user') || '{}');
            if (!currentUser.userId) { window.location.href = 'login.html'; return; }
            document.getElementById('userName').textContent = currentUser.name;
            loadRecommendations('personal');
        };

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.recommend-section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            currentTab = tabName;
            if (!loadedTabs.has(tabName)) { loadRecommendations(tabName); }
        }

        async function loadRecommendations(type) {
            const endpoints = {
                personal: '/api/recommend/personal',
                similar: '/api/recommend/similar',
                popular: '/api/recommend/popular',
                category: '/api/recommend/category',
                new: '/api/recommend/new',
                hybrid: '/api/recommend/hybrid'
            };
            try {
                const response = await fetch(`${API_BASE_URL}${endpoints[type]}?userId=${currentUser.userId}`);
                const data = await response.json();
                if (data.success) { displayBooks(type, data.data); loadedTabs.add(type); }
                else { showEmpty(type, data.message || 'åŠ è½½å¤±è´¥'); }
            } catch (error) { console.error('åŠ è½½æ¨èå¤±è´¥:', error); showEmpty(type, 'ç½‘ç»œé”™è¯¯'); }
        }

        function displayBooks(type, books) {
            const container = document.getElementById(`${type}Books`);
            if (!books || books.length === 0) { showEmpty(type, 'æš‚æ— æ¨è'); return; }
            container.innerHTML = books.map(book => `
                <div class="book-card" onclick="viewBook('${book.isbn}')">
                    <div class="book-cover">ğŸ“–</div>
                    <div class="book-title" title="${book.title}">${book.title}</div>
                    <div class="book-author">ä½œè€…ï¼š${book.author}</div>
                    <div class="book-meta">
                        <span class="book-category">${book.category || 'æœªåˆ†ç±»'}</span>
                        ${book.score ? `<span class="book-score">â­ ${book.score.toFixed(1)}</span>` : ''}
                    </div>
                    ${book.reason ? `<div class="reason-tag">${book.reason}</div>` : ''}
                </div>
            `).join('');
        }

        function showEmpty(type, message) {
            const container = document.getElementById(`${type}Books`);
            container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">ğŸ“š</div><p>${message}</p></div>`;
        }

        function viewBook(isbn) { window.location.href = `book-detail.html?isbn=${isbn}`; }
    </script>
</body>
</html>

